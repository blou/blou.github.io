<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wall Reaction Game – Version 10</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
    }

    .game-wrapper {
      width: 100%;
      max-width: 420px;
      padding-top: 16px;
      position: relative;
    }

    .hud {
      text-align: center;
      margin-bottom: 10px;
      font-size: 18px;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background: #000;
      touch-action: none;
    }

    .center-message {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      pointer-events: none;
    }

    #gameover {
      font-size: 32px;
      color: red;
      top: 42%;
    }

    #startMessage {
      font-size: 20px;
      color: #aaa;
      top: 52%;
    }
  </style>
</head>
<body>

<div class="game-wrapper">
  <div class="hud">
    Score: <span id="score">0</span> · High Score: <span id="highScore">0</span>
  </div>

  <canvas id="game"></canvas>

  <div id="gameover" class="center-message" style="display:none;">GAME OVER</div>
  <div id="startMessage" class="center-message">Press an arrow key or tap to start</div>
</div>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const scoreEl = document.getElementById('score');
  const highScoreEl = document.getElementById('highScore');
  const startMessage = document.getElementById('startMessage');
  const gameOverEl = document.getElementById('gameover');

  const WALL_THICKNESS = 10;
  const TAP_PADDING = 25;
  const SPEED_INCREASE = 1.03;

  let walls = { left:false, right:false, top:false, bottom:false };
  let score = 0;
  let gameStarted = false;
  let gameOver = false;

  let highScore = Number(localStorage.getItem('wallGameHighScore')) || 0;
  highScoreEl.textContent = highScore;

  const ball = { x:0, y:0, r:10, vx:0, vy:0 };

  function resize() {
    const width = Math.min(window.innerWidth * 0.95, 420);
    const height = width * 1.25;

    canvas.width = width;
    canvas.height = height;

    resetBall();
  }

  function resetBall() {
    ball.x = canvas.width / 2;
    ball.y = canvas.height / 2;

    const angle = (Math.PI / 4) + Math.random() * (Math.PI / 2);
    const speed = 180;

    const dirX = Math.random() < 0.5 ? -1 : 1;
    const dirY = Math.random() < 0.5 ? -1 : 1;

    ball.vx = Math.cos(angle) * speed * dirX;
    ball.vy = Math.sin(angle) * speed * dirY;
  }

  function activateWall(name) {
    for (let w in walls) walls[w] = false;
    walls[name] = true;
  }

  function startGame() {
    score = 0;
    scoreEl.textContent = score;
    gameStarted = true;
    gameOver = false;
    gameOverEl.style.display = 'none';
    startMessage.style.display = 'none';

    // Clear all wall activations before starting
    for (let w in walls) walls[w] = false;

    resetBall();
  }

  function endGame() {
    gameOver = true;
    gameStarted = false;
    gameOverEl.style.display = 'block';
    startMessage.style.display = 'block';

    if (score > highScore) {
      highScore = score;
      localStorage.setItem('wallGameHighScore', highScore);
      highScoreEl.textContent = highScore;
    }
  }

  window.addEventListener('keydown', e => {
    if (!e.key.startsWith('Arrow')) return;

    if (!gameStarted) {
      startGame();
      return;
    }

    if (e.key === 'ArrowLeft') activateWall('left');
    if (e.key === 'ArrowRight') activateWall('right');
    if (e.key === 'ArrowUp') activateWall('top');
    if (e.key === 'ArrowDown') activateWall('bottom');
  });

  canvas.addEventListener('pointerdown', e => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    if (!gameStarted) {
      startGame();
      return;
    }

    if (x < WALL_THICKNESS + TAP_PADDING) activateWall('left');
    else if (x > canvas.width - WALL_THICKNESS - TAP_PADDING) activateWall('right');
    else if (y < WALL_THICKNESS + TAP_PADDING) activateWall('top');
    else if (y > canvas.height - WALL_THICKNESS - TAP_PADDING) activateWall('bottom');
  });

  let lastTime = performance.now();

  function update(dt) {
    if (!gameStarted || gameOver) return;

    ball.x += ball.vx * dt;
    ball.y += ball.vy * dt;

    if (ball.x - ball.r <= 0) {
      walls.left ? bounce('x') : endGame();
    }
    if (ball.x + ball.r >= canvas.width) {
      walls.right ? bounce('x') : endGame();
    }
    if (ball.y - ball.r <= 0) {
      walls.top ? bounce('y') : endGame();
    }
    if (ball.y + ball.r >= canvas.height) {
      walls.bottom ? bounce('y') : endGame();
    }
  }

  function bounce(axis) {
    score++;
    scoreEl.textContent = score;

    if (axis === 'x') ball.vx *= -SPEED_INCREASE;
    else ball.vy *= -SPEED_INCREASE;
  }

  function drawWalls() {
    ctx.fillStyle = walls.left ? 'red' : '#555';
    ctx.fillRect(0, 0, WALL_THICKNESS, canvas.height);

    ctx.fillStyle = walls.right ? 'red' : '#555';
    ctx.fillRect(canvas.width - WALL_THICKNESS, 0, WALL_THICKNESS, canvas.height);

    ctx.fillStyle = walls.top ? 'red' : '#555';
    ctx.fillRect(0, 0, canvas.width, WALL_THICKNESS);

    ctx.fillStyle = walls.bottom ? 'red' : '#555';
    ctx.fillRect(0, canvas.height - WALL_THICKNESS, canvas.width, WALL_THICKNESS);
  }

  function drawBall() {
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
    ctx.fillStyle = '#00ffcc';
    ctx.fill();
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawWalls();
    drawBall();
  }

  function loop(time) {
    const dt = (time - lastTime) / 1000;
    lastTime = time;

    update(dt);
    draw();
    requestAnimationFrame(loop);
  }

  resize();
  window.addEventListener('resize', resize);
  requestAnimationFrame(loop);
</script>

</body>
</html>
