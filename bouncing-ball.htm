<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wall Bounce Game â€“ v7</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .scores {
      margin: 10px 0 6px 0;
      text-align: center;
      font-size: 14px;
    }

    canvas {
      background: #000;
      touch-action: manipulation;
    }

    .overlay {
      position: absolute;
      text-align: center;
      pointer-events: none;
      color: #aaa;
    }

    .game-wrapper {
      position: relative;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="scores">
      <div>Score: <span id="score">0</span></div>
      <div>High Score: <span id="highScore">0</span></div>
    </div>

    <div class="game-wrapper">
      <canvas id="game"></canvas>
      <div id="overlay" class="overlay"></div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');

    const scoreEl = document.getElementById('score');
    const highScoreEl = document.getElementById('highScore');

    let score = 0;
    let highScore = Number(localStorage.getItem('wallHighScore')) || 0;
    highScoreEl.textContent = highScore;

    const wallThickness = 12;
    const ballRadius = 8;

    let ball, running = false;
    let activeWall = null;

    function resizeCanvas() {
      const vw = Math.min(window.innerWidth, 420);
      const vh = window.innerHeight;

      canvas.width = vw - 20;
      canvas.height = Math.min(vh * 0.7, vw * 1.2);

      overlay.style.width = canvas.width + 'px';
      overlay.style.height = canvas.height + 'px';
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function resetBall() {
      const angleBase = Math.PI / 4;
      const angle = angleBase + Math.random() * (Math.PI / 2);
      const dirX = Math.random() < 0.5 ? -1 : 1;
      const dirY = Math.random() < 0.5 ? -1 : 1;

      ball = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        vx: Math.cos(angle) * dirX * 2,
        vy: Math.sin(angle) * dirY * 2
      };
    }

    function startGame() {
      score = 0;
      scoreEl.textContent = score;
      activeWall = null;
      resetBall();
      running = true;
      overlay.innerHTML = '';
    }

    function endGame() {
      running = false;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('wallHighScore', highScore);
        highScoreEl.textContent = highScore;
      }
      overlay.innerHTML = '<div style="margin-top:45%;">Game Over</div><div style="margin-top:8px;font-size:13px;">Press an arrow key or tap to start</div>';
    }

    function activateWall(wall) {
      if (!running) return;
      activeWall = wall;
    }

    document.addEventListener('keydown', e => {
      if (!running && ['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)) {
        startGame();
        return;
      }
      if (e.key === 'ArrowUp') activateWall('top');
      if (e.key === 'ArrowDown') activateWall('bottom');
      if (e.key === 'ArrowLeft') activateWall('left');
      if (e.key === 'ArrowRight') activateWall('right');
    });

    canvas.addEventListener('click', e => {
      if (!running) {
        startGame();
        return;
      }

      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      if (y < wallThickness) activateWall('top');
      else if (y > canvas.height - wallThickness) activateWall('bottom');
      else if (x < wallThickness) activateWall('left');
      else if (x > canvas.width - wallThickness) activateWall('right');
    });

    function update() {
      if (!running) return;

      ball.x += ball.vx;
      ball.y += ball.vy;

      const speedUp = 1.03;

      if (ball.y - ballRadius <= wallThickness) {
        if (activeWall === 'top') {
          ball.vy *= -speedUp; score++;
        } else endGame();
      }

      if (ball.y + ballRadius >= canvas.height - wallThickness) {
        if (activeWall === 'bottom') {
          ball.vy *= -speedUp; score++;
        } else endGame();
      }

      if (ball.x - ballRadius <= wallThickness) {
        if (activeWall === 'left') {
          ball.vx *= -speedUp; score++;
        } else endGame();
      }

      if (ball.x + ballRadius >= canvas.width - wallThickness) {
        if (activeWall === 'right') {
          ball.vx *= -speedUp; score++;
        } else endGame();
      }

      scoreEl.textContent = score;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const walls = ['top','bottom','left','right'];
      walls.forEach(w => {
        ctx.fillStyle = activeWall === w ? 'red' : '#555';
        if (w === 'top') ctx.fillRect(0, 0, canvas.width, wallThickness);
        if (w === 'bottom') ctx.fillRect(0, canvas.height - wallThickness, canvas.width, wallThickness);
        if (w === 'left') ctx.fillRect(0, 0, wallThickness, canvas.height);
        if (w === 'right') ctx.fillRect(canvas.width - wallThickness, 0, wallThickness, canvas.height);
      });

      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI * 2);
      ctx.fillStyle = '#00ffcc';
      ctx.fill();
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    overlay.innerHTML = '<div style="margin-top:45%;">Press an arrow key or tap to start</div>';
    resetBall();
    loop();
  </script>
</body>
</html>